<canvas width="450" height="450" id="vvhat"></canvas>
<script src="/socket.io/socket.io.js"></script>

<script>
  var mainCanvas  = document.getElementById("vvhat");
  var mainContext = mainCanvas.getContext('2d');

  var canvasWidth  = mainCanvas.width;
  var canvasHeight = mainCanvas.height;

  angle = 0;

  function drawCircle() {
      mainContext.clearRect(0, 0, canvasWidth, canvasHeight);
       
      // color in the background
      mainContext.fillStyle = "#EEEEEE";
      mainContext.fillRect(0, 0, canvasWidth, canvasHeight);
       
      // draw the circle
      mainContext.beginPath();
       
      var radius = 25 + 150 * Math.abs(Math.cos(angle));
      mainContext.arc(225, 225, radius, 0, Math.PI * 2, false);
      mainContext.closePath();
       
      // color in the circle
      mainContext.fillStyle = "#006699";
      mainContext.fill();
        
      angle += Math.PI / 64;
       
      requestAnimationFrame(drawCircle);
  }

  drawCircle();
</script>
<script>
  var start  = + new Date();
  var socket = io('http://localhost');

  setTimeout(function sendImage () {
    var data = mainCanvas.toDataURL('image/jpeg');
    

    var t = + new Date();

    if (t-start < 3000) {
      socket.emit('new', data);
      setTimeout(sendImage, 16);
    }
    else
      socket.emit('end');
  }, 16);
</script>